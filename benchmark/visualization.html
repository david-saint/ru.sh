<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LLM Judge Evaluation Comparison</title>
    <style>
      :root {
        --bg-color: #0a0c10;
        --card-bg: rgba(24, 27, 33, 0.7);
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --accent: #3b82f6;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --border: rgba(255, 255, 255, 0.1);
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
      }

      body {
        font-family:
          "Inter",
          system-ui,
          -apple-system,
          sans-serif;
        background-color: var(--bg-color);
        background-image:
          radial-gradient(
            circle at 50% 0%,
            rgba(59, 130, 246, 0.05) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 0% 100%,
            rgba(59, 130, 246, 0.02) 0%,
            transparent 50%
          );
        color: var(--text-primary);
        margin: 0;
        padding: 40px 24px;
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1,
      h2,
      h3 {
        margin-top: 0;
        color: var(--text-primary);
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 40px;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--border);
      }

      .header h1 {
        font-size: 32px;
        font-weight: 800;
        letter-spacing: -0.025em;
        margin-bottom: 4px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: var(--card-bg);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 24px;
        border-radius: 16px;
        border: 1px solid var(--glass-border);
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.5);
        border-color: rgba(255, 255, 255, 0.15);
      }

      .stat-value {
        font-size: 32px;
        font-weight: 800;
        margin-top: 12px;
        letter-spacing: -0.02em;
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .controls {
        display: flex;
        gap: 20px;
        background: var(--glass-bg);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        padding: 16px 24px;
        border-radius: 14px;
        margin-bottom: 40px;
        flex-wrap: wrap;
        align-items: center;
        border: 1px solid var(--glass-border);
      }

      select,
      input[type="text"] {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        border: 1px solid var(--glass-border);
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      select:hover,
      input[type="text"]:hover {
        background-color: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
      }

      select:focus,
      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent);
        background-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }

      label {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
      }

      .comparison-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background-color: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      th,
      td {
        padding: 16px;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      th {
        background-color: rgba(255, 255, 255, 0.02);
        font-weight: 600;
        color: var(--text-secondary);
      }

      tr:last-child td {
        border-bottom: none;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 9999px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-success {
        background-color: rgba(16, 185, 129, 0.2);
        color: #34d399;
      }
      .badge-danger {
        background-color: rgba(239, 68, 68, 0.2);
        color: #f87171;
      }
      .badge-neutral {
        background-color: rgba(156, 163, 175, 0.2);
        color: #9ca3af;
      }

      .prompt-text {
        font-weight: 600;
        font-size: 15px;
        margin-bottom: 12px;
        color: var(--text-primary);
      }

      .comparison-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .comp-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .comp-label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
        color: var(--text-secondary);
      }

      .code-block {
        background-color: rgba(0, 0, 0, 0.3);
        padding: 8px 10px;
        border-radius: 6px;
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        color: #d1d5db;
        white-space: pre-wrap;
        border: 1px solid transparent;
      }

      .code-block.expected {
        border-color: rgba(255, 255, 255, 0.05);
        background-color: rgba(255, 255, 255, 0.02);
        color: #9ca3af;
      }

      .diff-row {
        cursor: pointer;
      }

      .diff-row:hover {
        background-color: rgba(255, 255, 255, 0.02);
      }

      .filter-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .hidden {
        display: none;
      }

      #loading {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary);
      }

      /* Checkbox Styling */
      .checkbox-col {
        width: 30px;
        text-align: center;
      }

      input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        border-radius: 4px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      input[type="checkbox"]:checked {
        background-color: var(--accent);
        border-color: var(--accent);
      }

      input[type="checkbox"]:checked::after {
        content: "✓";
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      input[type="checkbox"]:hover {
        border-color: rgba(255, 255, 255, 0.3);
      }

      /* Floating Copy Button */
      #copy-container {
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 100;
        display: flex;
        gap: 12px;
        align-items: center;
        transform: translateY(100px);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      #copy-container.visible {
        transform: translateY(0);
      }

      .copy-btn {
        background: var(--accent);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.4);
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
      }

      .copy-btn:hover {
        background: #2563eb;
        transform: scale(1.02);
      }

      .copy-btn:active {
        transform: scale(0.98);
      }

      .selection-count {
        background: var(--glass-bg);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 13px;
        font-weight: 600;
        border: 1px solid var(--glass-border);
        color: var(--text-primary);
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <h1>LLM Judge Evaluation Comparison</h1>
          <div style="color: var(--text-secondary)">
            Comparing evaluations of various LLM outputs
          </div>
        </div>
        <div
          id="count-display"
          class="badge badge-neutral"
          style="font-size: 14px"
        >
          Loading...
        </div>
      </div>

      <div class="controls">
        <div class="filter-group">
          <label>Target Model</label>
          <select id="model-select"></select>
        </div>
        <div class="filter-group">
          <label>Compare</label>
          <div style="display: flex; gap: 8px; align-items: center">
            <select id="judge-a-select"></select>
            <span style="color: var(--text-secondary); font-size: 12px"
              >vs</span
            >
            <select id="judge-b-select"></select>
          </div>
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select id="filter-select">
            <option value="all">All Prompts</option>
            <option value="disagree">Disagreements (A ≠ B)</option>
            <option value="a_true_b_false">A Passed / B Rejected</option>
            <option value="a_false_b_true">A Rejected / B Passed</option>
            <option value="both_true">Both Passed</option>
            <option value="both_false">Both Rejected</option>
          </select>
        </div>
        <div
          class="filter-group"
          style="flex-grow: 1; justify-content: flex-end"
        >
          <input
            type="text"
            id="search-input"
            placeholder="Search prompts, generations..."
            style="min-width: 300px"
          />
        </div>
      </div>

      <div class="stats-grid" id="stats-container">
        <!-- Populated by JS (Only Human, Judge A, Judge B) -->
      </div>

      <div id="agreement-vis" style="margin-bottom: 40px"></div>

      <div id="loading">Loading data from data.json...</div>

      <table class="comparison-table" id="results-table">
        <thead>
          <tr>
            <th class="checkbox-col">
              <input type="checkbox" id="select-all-checkbox" />
            </th>
            <th style="width: 40%">Prompt & Generation</th>
            <th style="width: 10%">Human</th>
            <th style="width: 25%" id="col-header-a">Judge A</th>
            <th style="width: 25%" id="col-header-b">Judge B</th>
          </tr>
        </thead>
        <tbody id="results-body">
          <!-- Populated by JS -->
        </tbody>
      </table>

      <div id="copy-container">
        <div class="selection-count" id="selection-display">0 selected</div>
        <button class="copy-btn" id="copy-json-btn">
          <svg
            style="width: 18px; height: 18px"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
            ></path>
          </svg>
          Copy JSON
        </button>
      </div>
    </div>

    <script>
      let fullData = {};
      let currentModelData = [];
      let fuse = null; // Fuse instance
      let judges = [];

      async function loadData() {
        try {
          const response = await fetch("data.json");
          const jsonData = await response.json();

          if (jsonData.meta && jsonData.meta.judges) {
            fullData = jsonData.models;
            judges = jsonData.meta.judges;
          } else {
            // Fallback for old format
            fullData = jsonData;
            judges = ["Claude Code", "Gemini 2.5 Flash", "Gemini 3 Pro"];
          }

          document.getElementById("loading").style.display = "none";
          init();
        } catch (e) {
          document.getElementById("loading").innerHTML =
            `Error loading data.json<br><br>Make sure you are running a local server.<br><code>python3 -m http.server</code>`;
          console.error(e);
        }
      }

      function init() {
        populateSelectors();
        updateModelData(); // Initial load

        // Event listeners
        document
          .getElementById("model-select")
          .addEventListener("change", () => {
            updateModelData();
          });
        document
          .getElementById("judge-a-select")
          .addEventListener("change", () => {
            updateHeaders();
            renderTable();
            calculateStats();
          });
        document
          .getElementById("judge-b-select")
          .addEventListener("change", () => {
            updateHeaders();
            renderTable();
            calculateStats();
          });
        document
          .getElementById("filter-select")
          .addEventListener("change", renderTable);

        // Search listener
        document
          .getElementById("search-input")
          .addEventListener("input", renderTable);

        // Selection listeners
        document
          .getElementById("select-all-checkbox")
          .addEventListener("change", toggleSelectAll);
        document
          .getElementById("copy-json-btn")
          .addEventListener("click", copySelectedAsJson);
      }

      function populateSelectors() {
        const modelSelect = document.getElementById("model-select");
        const models = Object.keys(fullData).sort();

        models.forEach((m) => {
          const opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          modelSelect.appendChild(opt);
        });

        // Prefer the original benchmark model if present
        if (models.includes("google_gemini-3-flash-preview:nitro")) {
          modelSelect.value = "google_gemini-3-flash-preview:nitro";
        }

        const selectA = document.getElementById("judge-a-select");
        const selectB = document.getElementById("judge-b-select");

        judges.forEach((j) => {
          const optA = document.createElement("option");
          optA.value = j;
          optA.textContent = j;
          selectA.appendChild(optA);

          const optB = document.createElement("option");
          optB.value = j;
          optB.textContent = j;
          selectB.appendChild(optB);
        });

        if (judges.includes("Claude Code")) {
          selectA.value = "Claude Code";
        } else if (judges.length > 0) {
          selectA.value = judges[0];
        }

        if (judges.includes("Gemini 3 Pro")) {
          selectB.value = "Gemini 3 Pro";
        } else if (judges.length > 1) {
          selectB.value = judges[1];
        } else if (judges.length > 0) {
          selectB.value = judges[0];
        }

        updateHeaders();
      }

      function updateModelData() {
        const modelName = document.getElementById("model-select").value;
        currentModelData = fullData[modelName] || [];

        // Initialize Fuse
        // We include prompt, generated text, and expected text in search
        fuse = new Fuse(currentModelData, {
          keys: ["prompt", "generated", "expected"],
          threshold: 0.4,
          useExtendedSearch: true,
        });

        calculateStats();
        // Reset search on model change? Optional. Let's keep it for now but maybe clear the input?
        // document.getElementById("search-input").value = "";
        renderTable();
      }

      function updateHeaders() {
        document.getElementById("col-header-a").textContent =
          document.getElementById("judge-a-select").value;
        document.getElementById("col-header-b").textContent =
          document.getElementById("judge-b-select").value;
      }

      function calculateStats() {
        const container = document.getElementById("stats-container");
        const judgeA = document.getElementById("judge-a-select").value;
        const judgeB = document.getElementById("judge-b-select").value;
        container.innerHTML = "";

        // Standard Stats
        const stats = {};
        const selectedJudges = [judgeA, judgeB];

        // Use a set to handle cases where judgeA == judgeB
        const uniqueSelected = [...new Set(selectedJudges)];

        uniqueSelected.forEach((j) => (stats[j] = { passed: 0, total: 0 }));
        let humanPassed = 0;

        // Agreement Stats
        const agreement = {};
        uniqueSelected.forEach((j) => (agreement[j] = { match: 0, total: 0 }));

        currentModelData.forEach((row) => {
          if (row.human_correct) humanPassed++;

          uniqueSelected.forEach((j) => {
            // Pass/Fail Stats
            if (row.evaluations[j] === true) stats[j].passed++;
            if (row.evaluations[j] !== null && row.evaluations[j] !== undefined)
              stats[j].total++;

            // Agreement Stats (Judge Verdict == Human Verdict)
            if (
              row.evaluations[j] !== null &&
              row.evaluations[j] !== undefined
            ) {
              agreement[j].total++;
              if (row.evaluations[j] === row.human_correct) {
                agreement[j].match++;
              }
            }
          });
        });

        // Add Human Stat
        addStatCard(
          container,
          "Human (String Match)",
          humanPassed,
          currentModelData.length,
          "#94a3b8",
          null,
        );

        // Add Judge Stats
        uniqueSelected.forEach((j) => {
          const agreeData = agreement[j];
          const agreePct =
            agreeData.total > 0
              ? ((agreeData.match / agreeData.total) * 100).toFixed(1)
              : "0.0";

          addStatCard(
            container,
            j,
            stats[j].passed,
            stats[j].total,
            getColorForJudge(j),
            `Agreement w/ Human: <strong>${agreePct}%</strong>`,
          );
        });

        renderAgreementVis(agreement);
      }

      function renderAgreementVis(agreementStats) {
        const judgeA = document.getElementById("judge-a-select").value;
        const judgeB = document.getElementById("judge-b-select").value;
        const container = document.getElementById("agreement-vis");

        if (!judgeA || !judgeB) return;

        const statsA = agreementStats[judgeA];
        const statsB = agreementStats[judgeB];

        if (!statsA || !statsB) return;

        const pctA = statsA.total > 0 ? (statsA.match / statsA.total) * 100 : 0;
        const pctB = statsB.total > 0 ? (statsB.match / statsB.total) * 100 : 0;

        container.innerHTML = `
            <div style="background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); padding: 24px; border-radius: 16px; border: 1px solid var(--glass-border);">
                <h3 style="font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); margin-bottom: 24px;">Agreement with String Match (Human)</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
                        <span style="font-weight: 500;">${judgeA}</span>
                        <span style="font-weight: 700;">${pctA.toFixed(1)}%</span>
                    </div>
                    <div style="background-color: rgba(255,255,255,0.05); height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05);">
                        <div style="width: ${pctA}%; height: 100%; background: linear-gradient(90deg, ${getColorForJudge(judgeA)}, #fff); opacity: 0.8; border-radius: 5px;"></div>
                    </div>
                </div>

                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
                        <span style="font-weight: 500;">${judgeB}</span>
                        <span style="font-weight: 700;">${pctB.toFixed(1)}%</span>
                    </div>
                    <div style="background-color: rgba(255,255,255,0.05); height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05);">
                        <div style="width: ${pctB}%; height: 100%; background: linear-gradient(90deg, ${getColorForJudge(judgeB)}, #fff); opacity: 0.8; border-radius: 5px;"></div>
                    </div>
                </div>
            </div>
          `;
      }

      function addStatCard(
        container,
        name,
        passed,
        total,
        color,
        secondaryText,
      ) {
        const percentage =
          total > 0 ? ((passed / total) * 100).toFixed(1) : "0.0";
        const div = document.createElement("div");
        div.className = "stat-card";
        div.style.borderTop = `4px solid ${color}`;

        let secondaryHtml = "";
        if (secondaryText) {
          secondaryHtml = `<div style="margin-top: 16px; font-size: 13px; color: var(--text-secondary); border-top: 1px solid var(--border); padding-top: 12px; display: flex; align-items: center; gap: 4px;">
            <svg style="width: 14px; height: 14px; opacity: 0.7;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            ${secondaryText}
          </div>`;
        }

        div.innerHTML = `
                <div class="stat-label">${name}</div>
                <div class="stat-value" style="color: ${passed > 0 ? "white" : "var(--danger)"}">
                    ${percentage}%
                    <span style="font-size: 16px; color: var(--text-secondary); font-weight: 500; margin-left: 4px; opacity: 0.6;">(${passed}/${total})</span>
                </div>
                ${secondaryHtml}
            `;
        container.appendChild(div);
      }

      function getColorForJudge(name) {
        if (name.includes("Claude")) return "#d97757"; // Orange-ish
        if (name.includes("Gemini")) return "#4285f4"; // Blue
        return "#ffffff";
      }

      function renderTable() {
        const judgeA = document.getElementById("judge-a-select").value;
        const judgeB = document.getElementById("judge-b-select").value;
        const filter = document.getElementById("filter-select").value;
        const searchQuery = document
          .getElementById("search-input")
          .value.trim();
        const tbody = document.getElementById("results-body");

        tbody.innerHTML = "";

        let count = 0;

        let rowsToRender = currentModelData;
        if (searchQuery && fuse) {
          rowsToRender = fuse.search(searchQuery).map((result) => result.item);
        }

        // Add index to each row for tracking
        rowsToRender.forEach((row, index) => {
          const resA = row.evaluations[judgeA];
          const resB = row.evaluations[judgeB];

          // Filtering Logic
          if (filter === "disagree" && resA === resB) return;
          if (filter === "a_true_b_false" && !(resA === true && resB === false))
            return;
          if (filter === "a_false_b_true" && !(resA === false && resB === true))
            return;
          if (filter === "both_true" && !(resA === true && resB === true))
            return;
          if (filter === "both_false" && !(resA === false && resB === false))
            return;

          count++;

          const tr = document.createElement("tr");
          tr.setAttribute("data-index", currentModelData.indexOf(row));
          tr.innerHTML = `
                    <td class="checkbox-col">
                        <input type="checkbox" class="row-checkbox" onchange="updateSelectionUI()">
                    </td>
                    <td style="vertical-align: top;">
                        <div class="prompt-text">${escapeHtml(row.prompt)}</div>
                        <div class="comparison-grid">
                            <div class="comp-block">
                                <div class="comp-label" style="color: #60a5fa;">Generated</div>
                                <div class="code-block">${escapeHtml(row.generated)}</div>
                            </div>
                            <div class="comp-block">
                                <div class="comp-label">Expected</div>
                                <div class="code-block expected">${escapeHtml(row.expected)}</div>
                            </div>
                        </div>
                    </td>
                    <td style="vertical-align: top;">
                        ${renderBadge(row.human_correct)}
                    </td>
                    <td style="vertical-align: top;">
                        ${renderBadge(resA)}
                    </td>
                    <td style="vertical-align: top;">
                        ${renderBadge(resB)}
                    </td>
                `;
          tbody.appendChild(tr);
        });

        document.getElementById("count-display").textContent =
          `Showing ${count} prompts`;

        // Reset "Select All" checked state
        document.getElementById("select-all-checkbox").checked = false;
        updateSelectionUI();
      }

      function toggleSelectAll() {
        const isChecked = document.getElementById(
          "select-all-checkbox",
        ).checked;
        const checkboxes = document.querySelectorAll(".row-checkbox");
        checkboxes.forEach((cb) => (cb.checked = isChecked));
        updateSelectionUI();
      }

      function updateSelectionUI() {
        const selected = document.querySelectorAll(".row-checkbox:checked");
        const count = selected.length;
        const container = document.getElementById("copy-container");
        const display = document.getElementById("selection-display");

        display.textContent = `${count} Selected`;

        if (count > 0) {
          container.classList.add("visible");
        } else {
          container.classList.remove("visible");
        }
      }

      function copySelectedAsJson() {
        const judgeA = document.getElementById("judge-a-select").value;
        const judgeB = document.getElementById("judge-b-select").value;
        const selectedCheckboxes = document.querySelectorAll(
          ".row-checkbox:checked",
        );
        const selectedData = [];

        selectedCheckboxes.forEach((cb) => {
          const index = cb.closest("tr").getAttribute("data-index");
          const row = currentModelData[index];

          const resA = row.evaluations[judgeA];
          const resB = row.evaluations[judgeB];

          selectedData.push({
            prompt: row.prompt,
            generated: row.generated,
            judge_a:
              resA === true ? "correct" : resA === false ? "incorrect" : "N/A",
            judge_b:
              resB === true ? "correct" : resB === false ? "incorrect" : "N/A",
            i_expected: {
              command: row.expected,
              string_match:
                row.human_correct === true
                  ? "correct"
                  : row.human_correct === false
                    ? "incorrect"
                    : "N/A",
            },
          });
        });

        const jsonString = JSON.stringify(selectedData, null, 4);

        navigator.clipboard
          .writeText(jsonString)
          .then(() => {
            const btn = document.getElementById("copy-json-btn");
            const originalText = btn.innerHTML;
            btn.textContent = "Copied!";
            btn.style.background = "var(--success)";
            setTimeout(() => {
              btn.innerHTML = originalText;
              btn.style.background = "var(--accent)";
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy!", err);
            alert("Could not copy to clipboard. Check console.");
          });
      }

      function renderBadge(value) {
        if (value === true)
          return '<span class="badge badge-success">Correct</span>';
        if (value === false)
          return '<span class="badge badge-danger">Incorrect</span>';
        return '<span class="badge badge-neutral">N/A</span>';
      }

      function escapeHtml(text) {
        if (!text) return "";
        return text
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      loadData();
    </script>
  </body>
</html>
